{% extends "baaswebapp/layout.html" %}
{% load widget_tweaks %}

{% block topbaastitle %}
<div class="nav-item vertical-line-right vertical-line-left">
    <a class="nav-link txt-brand txt-presicav-22 ms-3" href="{% url 'product_api' trial.product.id %}">{{trial.product}}</a>
</div>
{% endblock %}
{% load i18n %}
{% block topbaasheader %}
    <li class="nav-item">
        <a class="nav-link txt-brand txt-presicav-18" href="{% url 'trial_api' trial.id %}">
            <span class="material-symbols-outlined small-icon">assessment</span>
            {{description}}</a>
    </li>
    <li class="nav-item">
        <p class="navbar-text txt-baas txt-encode-18" >{{location}}, {{period}}</p>
    </li>
    <li class="nav-item">
        <a class="btn btn-outline-baas-alt ms-3" href="{% url 'fieldtrial_api' trial.id %}">{{trial.code}}</a>
    </li>
    <li class="nav-item">
        <div class="btn btn-baas-alt ms-2 capitalize-first">{% trans "efficacy"%}<span class='strong ms-2'>{{efficacy}}%</span></div>
    </li>
</ul>
<ul class="navbar-nav ms-4 vertical-line-left">
    <li class="nav-item  ms-3">
        {% include 'trialapp/btn_trials.html' with count_trials=other_trials tag='product' tagId=trial.product.id extraInfo=trial.product extra_params=''%}
    </li>

{% endblock %}

{% block content %}

<div class="row ">
    <div class="col-md-10 offset-md-1">
    <ul class="nav nav-tabs-baas" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active txt-open-semibold-15 capitalize-first" id="conclusions-tab" data-bs-toggle="tab" data-bs-target="#nav-conclusions" type="button" role="tab" aria-controls="nav-conclusions" aria-selected="true">{% trans "conclusions" %}</button>
        </li>
        <li class="nav-item">
            <button class="nav-link txt-open-semibold-15 capitalize-first" id="design-trial-tab" data-bs-toggle="tab" data-bs-target="#nav-design-trial" type="button" role="tab" aria-controls="nav-design-trial" aria-selected="true">{% trans "trial Design" %}</button>
        </li>
        <li class="nav-item">
        <button class="nav-link txt-open-semibold-15 capitalize-first" id="result-summary-tab" data-bs-toggle="tab" data-bs-target="#nav-result-summary" type="button" role="tab" aria-controls="nav-result-summary" aria-selected="true">{% trans "result summary" %}</button>
        </li>
        <li class="nav-item">
            <button class="nav-link txt-open-semibold-15 capitalize-first" id="trends-tab" data-bs-toggle="tab" data-bs-target="#nav-trends" type="button" role="tab" aria-controls="nav-trends" aria-selected="true">{% trans "trends" %}</button>
        </li>
        <li class="nav-item">
        <button class="nav-link txt-open-semibold-15 capitalize-first" id="data-tab" data-bs-toggle="tab" data-bs-target="#nav-data" type="button" role="tab" aria-controls="nav-data" aria-selected="true">{% trans "data" %}</button>
        </li>
        <li class="nav-item">
        <button class="nav-link txt-open-semibold-15 capitalize-first" id="assessment-tab" data-bs-toggle="tab" data-bs-target="#nav-assessment" type="button" role="tab" aria-controls="nav-assessment" aria-selected="true">{% trans "assessments" %}</button>
        </li>
        <li class="nav-item">
        <button class="nav-link txt-open-semibold-15 capitalize-first" id="info-tab" data-bs-toggle="tab" data-bs-target="#nav-info" type="button" role="tab" aria-controls="nav-info" aria-selected="true">Info</button>
        </li>
        <li class="nav-item">
            <a href="{% url 'download_pdf' trial.id %}" class="nav-link txt-brand txt-open-semibold-15 capitalize-first"
                data-toggle="tooltip" data-placement="top" title='Download trial'>{% trans "download trial" %} &dHar;</a>
        </li>
    </ul>
    <div class="tab-content" id="nav-trial">
        <div class="tab-pane fade show active" id="nav-conclusions" role="tabpanel" aria-labelledby="conclusions-tab">
            {% include 'trialapp/trial_conclusions.html' %}
        </div>
        <div class="tab-pane fade" id="nav-design-trial" role="tabpanel" aria-labelledby="design-trial-tab">
            {% include 'trialapp/fieldtrial_design.html' with thesis_list=thesisDetail %}
        </div>
        <div class="tab-pane fade" id="nav-result-summary" role="tabpanel" aria-labelledby="result-summary-tab">
            <p class="txt-encode-20 capitalize-first mt-3">{% trans 'average efficacy'%}</p>
            {% include 'trialapp/trial_content_topic_div.html' with topic='result_summary'%}
        </div>
        <div class="tab-pane fade" id="nav-trends" role="tabpanel" aria-labelledby="trends-tab">
            {% include 'trialapp/trial_content_topic_div.html' with topic='weather_graphs'%}
            {% include 'trialapp/trial_content_topic_div.html' with topic='assess_graphs'%}
        </div>
        <div class="tab-pane fade" id="nav-data" role="tabpanel" aria-labelledby="data-tab">
            data
        </div>
        <div class="tab-pane fade" id="nav-assessment" role="tabpanel" aria-labelledby="assessment-tab">
            assessment
        </div>
        <div class="tab-pane fade" id="nav-info" role="tabpanel" aria-labelledby="info-tab">
            info
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>


    // Load all dynamic content like graphs
    $(document).ready(function() {
    // Loop through each dynamic div
        $('.trial-dynamic-content').each(function() {
            var divId = $(this).attr('id'); // Get the ID of the current div
            /* Id will be like trial-id-contentId */
            var items = divId.split('-');
            var contentType = items[2]
            var trialId = items[1]
            // Make an AJAX call to the Django server
            $.ajax({
                type: 'GET',
                url: '/trial_content_api' ,  // Update with the actual URL
                data: { content_type: contentType, id: trialId }, // Send the div ID to the server
                success: function(response) {
                    // Update the content of the div with the loaded content
                    $('#' + divId).html(response);
                },
                error: function() {
                    // Handle error if the AJAX call fails
                    $('#' + divId).html('<p>Error loading content.</p>');
                }
            });
        });
    });

    // Create a default Marker and add it to the map.
    var latitude={{trial.latitude}};
    var longitude={{trial.longitude}};
</script>
<script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
<script src='/static/baaswebapp/scripts/mapbaas.js'></script>
{% endblock %}  